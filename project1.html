<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Share - Upload Notes</title>
    <style>
        .navbar {
            background: linear-gradient(to left,rgb(250, 250, 105),rgb(243, 243, 47),rgb(252, 164, 0));
            border: 2px solid;
            border-color: rgb(8, 8, 8); 
            position: sticky;
        }
        .navbar ul {
            overflow: auto;
        }
        .navbar li {
            float: left;
            list-style: none;
            margin: 13px 20px;
        }
        .navbar li a {
            padding: 3px 3px;
            color: rgb(0, 0, 0);
            text-decoration: none;
        }
        .navbar li a:hover {
            color: rgb(50, 248, 232);
        }
        body {
            background-image: url(https://images.pexels.com/photos/762686/pexels-photo-762686.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1);
            background-size: cover;
        }
        .search {
            float: right;
            padding: 12px 75px;
            color: whitesmoke; 
        } 
        .navbar input {
            border: 2px solid;
            border-color: blue;
            border-radius: 3px;
        }
        .acc {
            float:right;
            padding: 12px 75px;
        } 
        .acc a {
            text-decoration: none;
            background: linear-gradient(to left,rgb(250, 250, 105),rgb(243, 243, 47),rgb(252, 164, 0));
        }
        .acc a:hover {
            color: blueviolet;
        } 
        #title {
            color:rgb(3, 3, 3)
        }
        .lb {
            color: rgb(0, 0, 0);
        }
        .input-group { 
            width: 380px;
            height: 480px;
            position:relative;
            margin: 2% auto;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.3);
            padding: 5px;
        } 
        .btn1 {
            border: 1px solid rgb(0, 0, 0);
        } 
        .btn2 {
            border: 2px solid black;
            position:relative;
        }
        .Mydiv {
            text-align: center;
        } 
        .input-group {
            align-items: center; 
            padding: 10px 30px;
        }
        /* Popup styles */
        .popup {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: white;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            z-index: 1000;
        }
        .popup h2 {
            color: #4CAF50;
        }
        .popup button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
        .popup button:hover {
            background-color: #45a049;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 500;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Upload notes</a></li>
                <li><a href="#">View notes</a></li>
                <li><a href="#">About us</a></li>
                <div class="search">
                    <input type="text" name="search" id="search" placeholder="Search this website">
                </div>
                <div class="acc">
                    <a href="login.html">Login/Register</a>
                </div>
            </ul>
        </nav>
    </header> 
    <h1 align="center" id="title"><b>Upload Notes</b></h1>
    <hr>
    <div>
        <form class="input-group">
            <div>
                <label for="Mybranch" class="lb"><b>Select Branch:</b></label>
                <br>
                <select name="Mybranch" id="Branch" class="select1">
                    <option value="FE">First year Engineering</option>
                    <option value="comp">Computer</option>
                    <option value="aiml">CS(AIML)</option>
                    <option value="ds">CS(DS)</option>
                    <option value="extc">EXTC</option>
                    <option value="civil">Civil</option>
                    <option value="mech">Mechanical</option>
                </select>            
            </div>
            <div>
                <label for="sem" class="lb"><b>Semester</b></label><br>
                <select name="sem" id="sem">
                    <option value="s1">1</option>
                    <option value="s2">2</option>
                    <option value="s3">3</option>
                    <option value="s4">4</option>
                    <option value="s5">5</option>
                    <option value="s6">6</option>
                    <option value="s7">7</option>
                    <option value="s8">8</option>
                </select>
            </div>
            <div class="lb">
                <b>Subject:</b><br><input type="text" name="subject" id="subject">
            </div> 
            <div> 
                <b>Select File:</b>
                <input type="file" id="fileUpload" class="btn1">
            </div><br>
            <label for="filetype" class="lb"><b>File Type</b></label>
            <select name="filetype" id="ft">
                <option value="pdf">PDF</option>
                <option value="wd">Word Document</option>
                <option value="jpg">JPG</option>
                <option value="png">PNG</option>
            </select>
            <br><br>
            <div class="Mydiv">
                <button type="button" id="btn" class="btn2">Upload</button> 
                <button type="reset" class="btn2">Reset</button>
            </div>
            <div id="status"></div>
            <div id="filePreview"></div>
        </form>
    </div>

    <!-- Popup for upload success -->
    <div class="overlay" id="overlay"></div>
    <div class="popup" id="popup">
        <h2>Upload Successful!</h2>
        <p>Your document has been uploaded successfully.</p>
        <button id="closePopup">Close</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBwXxfmIKwH43zNE5NCCHvzJ5YNobm1lLQ",
            authDomain: "mainminiproject-33e57.firebaseapp.com",
            projectId: "mainminiproject-33e57",
            storageBucket: "mainminiproject-33e57.appspot.com",
            messagingSenderId: "772675430843",
            appId: "1:772675430843:web:9f7dcc6e26b523fd047c9e",
            measurementId: "G-Y4JNPW985V"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const db = firebase.firestore();

        const fileInput = document.getElementById('fileUpload');
        const uploadBtn = document.getElementById('btn');
        const statusDiv = document.getElementById('status');
        const filePreview = document.getElementById('filePreview');
        const popup = document.getElementById('popup');
        const overlay = document.getElementById('overlay');
        const closePopupBtn = document.getElementById('closePopup');

        uploadBtn.addEventListener('click', async function () {
            const file = fileInput.files[0];
            const branch = document.getElementById('Branch').value;
            const semester = document.getElementById('sem').value;
            const subject = document.getElementById('subject').value;
            const fileType = document.getElementById('ft').value;

            if (file) {
                statusDiv.innerHTML = 'Uploading...';

                const storageRef = storage.ref('uploads/' + file.name);
                const uploadTask = storageRef.put(file);

                uploadTask.on('state_changed', 
                    (snapshot) => {
                        let progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        statusDiv.innerHTML = 'Upload is ' + progress + '% done';
                    }, 
                    (error) => {
                        statusDiv.innerHTML = 'Error uploading file: ' + error.message;
                    }, 
                    async () => {
                        const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();

                        // Save file info to Firestore
                        await db.collection('files').add({
                            url: downloadURL,
                            name: file.name,
                            type: fileType,
                            branch: branch,
                            semester: semester,
                            subject: subject,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        statusDiv.innerHTML = 'File uploaded successfully!';
                        filePreview.innerHTML = `<p>File Name: ${file.name}</p><p>File Type: ${fileType}</p><a href="${downloadURL}" target="_blank">View File</a>`;

                        // Show popup
                        overlay.style.display = 'block';
                        popup.style.display = 'block';
                    }
                );
            } else {
                statusDiv.innerHTML = 'Please select a file to upload!';
            }
        });

        closePopupBtn.addEventListener('click', function () {
            overlay.style.display = 'none';
            popup.style.display = 'none';
        });
    </script>
</body>
</html>
